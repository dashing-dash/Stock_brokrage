
function fnExcelReport() {
    var tab_text = '<html xmlns:x="urn:schemas-microsoft-com:office:excel">';
    tab_text = tab_text + '<head><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>';

    tab_text = tab_text + '<x:Name>Test Sheet</x:Name>';

    tab_text = tab_text + '<x:WorksheetOptions><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet>';
    tab_text = tab_text + '</x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body><table>';
    var table1 = document.getElementById("stock");
    var rowCount1 = table1.rows.length;
    for(var j=rowCount1;j>0;j--)
    {
        if($(".stock tr:nth-child("+j+") td:nth-child(2) input ").val()!='')
        {
            rowCount1=j+1;
            break;
        }
    }
    var tbl_data = '<tr><th>Sr. No.</th><th>Name</th><th>Sales</th><th>Purchase</th><th>rate</th><th>net rate</th><th>Brokrage</th><th>Amount</th><th>Amount net rate</th><th>Total sales</th><th>Total purchase</th><th>Net Shares</th><th>Sales Average</th><th>Purchase Average</th><th>Difference</th><th>Standing Average</th><th>Standing Amount</th><th>Outstanding</th><th>Closing</th></tr>';
    for (var i = 2; i < rowCount1; i++) {
        var name = $(".stock tr:nth-child("+i+") td:nth-child(2) input ").val();
        var sales=$(".stock tr:nth-child("+i+") td:nth-child(3) input ").val();
        var purchase=$(".stock tr:nth-child("+i+") td:nth-child(4) input ").val();
        var rate=$(".stock tr:nth-child("+i+") td:nth-child(5) input ").val();
        var net_rate=$(".stock tr:nth-child("+i+") td:nth-child(6) ").text();
        var brok=$(".stock tr:nth-child("+i+") td:nth-child(7) ").text();
        var amt=$(".stock tr:nth-child("+i+") td:nth-child(8) ").text();
        var amt_net=$(".stock tr:nth-child("+i+") td:nth-child(9) input").val();
        var total_sales=$(".stock tr:nth-child("+i+") td:nth-child(10) ").text();
        var total_purchase=$(".stock tr:nth-child("+i+") td:nth-child(11) ").text();
        var net_shares=$(".stock tr:nth-child("+i+") td:nth-child(12) ").text();
        var sales_avg=$(".stock tr:nth-child("+i+") td:nth-child(13) ").text();
        var pur_avg=$(".stock tr:nth-child("+i+") td:nth-child(14) ").text();
        var diff=$(".stock tr:nth-child("+i+") td:nth-child(15) ").text();
        var std_avg=$(".stock tr:nth-child("+i+") td:nth-child(16) ").text();
        var std_amt=$(".stock tr:nth-child("+i+") td:nth-child(17) ").text();
        var out=$(".stock tr:nth-child("+i+") td:nth-child(18) ").text();
        var closing=$(".stock tr:nth-child("+i+") td:nth-child(19) input ").val();
        tbl_data +='<tr><td>'+(i-1)+'</td><td>'+name+'</td><td>'+sales+'</td><td>'+purchase+'</td><td>'+rate+'</td><td>'+net_rate+'</td><td>'+brok+'</td><td>'+amt+'</td><td>'+amt_net+'</td><td>'+total_sales+'</td><td>'+total_purchase+'</td><td>'+net_shares+'</td><td>'+sales_avg+'</td><td>'+pur_avg+'</td><td>'+diff+'</td><td>'+std_avg+'</td><td>'+std_amt+'</td><td>'+out+'</td><td>'+closing+'</td></tr>';
    }

    tab_text = tab_text + "<table border='1px'>";
    tab_text = tab_text + tbl_data;
    tab_text = tab_text + '</table></body></html>';

    var data_type = 'data:application/vnd.ms-excel';
    
    var ua = window.navigator.userAgent;
    var msie = ua.indexOf("MSIE ");
    
    if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
        if (window.navigator.msSaveBlob) {
            var blob = new Blob([tab_text], {
                type: "application/xls;charset=utf-8;"
            });
            navigator.msSaveBlob(blob, 'Test file.xls');
        }
    } 
    else {
        $('#test').attr('href', data_type + ', ' + encodeURIComponent(tab_text));
        $('#test').attr('download', 'Test file.xls');
    }



     $('table').each(function () {
        var $table = $(this);        
        var csv = $table.table2CSV({
        delivery: 'value'   });     
        window.location.href = 'data:text/csv;charset=UTF-8,' 
            + encodeURIComponent(csv);
        });
    


}


