



function stock(){
			$(document).ready(function(){
						console.log("Working");

						
				$(".stock tr").click(function(){
					var row = parseInt($(this).index());
					var closing = $(".stock tr:nth-child("+row+") td:nth-child(19) .clsclose").val();
					if (closing=="") {
						return false;
					}
				});

				$(".stock tr td input").blur(function(event){					
							//$(".classi").prop("readonly", true);
						/*	$(".classf").prop("readonly", true);
							$(".classg").prop("readonly", true);
							$(".classh").prop("readonly", true);
							
							$(".clstotal1").prop("readonly", true);
							$(".clstotal2").prop("readonly", true);
							$(".clsnet1").prop("readonly", true);
							$(".clssales1").prop("readonly", true);
							$(".clspurchase1").prop("readonly", true);
							$(".clsdiff1").prop("readonly", true);
							$(".clsstdavg1").prop("readonly", true);
							$(".clsstdamt1").prop("readonly", true);
							$(".clsout1").prop("readonly", true);
							*/

							var table = document.getElementById("stock");
							var rowCount = table.rows.length;
							var row = $(this).parent().parent().index();
							//alert(row);
							if(row==rowCount-1)
							{
								$('.stock tr:last').after('<tr class="cls5"><td><input type="text" name="" onblur="stock()" class="classa"></td><td><input type="text" name="" onblur="stock()" class="classb" id="tags"></td><td><input type="text" name="" onblur="stock()" class="classc"></td><td><input type="text" name="" onblur="stock()" class="classd"></td><td><input type="text" name="" onblur="stock()" class="classe"></td><td><input type="text" name="" onblur="stock()" class="classf"></td><td><input type="text" name=""></td><td><input type="text" name=""></td><td ><input type="text" name=""></td><td><input type="text" name=""></td><td><input type="text" name=""></td><td><input type="text" name=""></td><td><input type="text" name=""></td></tr>');
							}
							var lot=0;
							var sales=0;
							var purchase=0;
							var rate=0;
							var amount=0;
							var brok=0;
							var net_rate=0;
							var amount_net=0;
							var name='';
							var closing=0;
							var sum = 0;
							var sum1 = 0;
							var sum2 = 0;
							var sum3 = 0;	
							var samt = 0;
							var bork_amt=0;
							var qty=0;

							name=$(this).parent().parent().find("td:nth-child(2) input").val();
							name=name.toUpperCase();
							$(this).parent().parent().find("td:nth-child(2) input").val(name);
							
							var $th = $(this);
	        				/*if($th.val()==$th.parent().parent().find("td:nth-child(3) input").val()||$th.val()==$th.parent().parent().find("td:nth-child(4) input").val()||$th.val()==$th.parent().parent().find("td:nth-child(6) input").val()||$th.val()==$th.parent().parent().find("td:nth-child(1) input").val())
	        				{
	        					$th.val( $th.val().replace(/[^0-9.]/g, function(){ return ''; }) );
							}*/
							/*if(event.keycode<48||event.keycode>57)
							{
								event="";
							}*/

							/*sales = parseFloat($(this).parent().parent().find("td:nth-child(3) input").val(),10);

							if (isNaN(sales)){
							 	sales=0;
							}*/

							lot = parseFloat($(this).parent().parent().find("td:nth-child(4) input").val(),10);
							/*if (isNaN(purchase)){
							 	purchase=0;
							}*/
							var qty=lot1(name)
							qty=qty*lot;
							if(isNaN(qty) || qty==0 || qty==""){
								qty=0;
							}
							$(this).parent().parent().find("td:nth-child(5) input").val(qty);
							rate = parseFloat($(this).parent().parent().find("td:nth-child(6) input").val(),10);
							//closing=parseFloat($(this).parent().parent().find("td:nth-child(19) input").val(),10);
							if (isNaN(rate)){
							 	rate=0;
							}

							if($(this).parent().parent().find("td:nth-child(6) input").val()!='')
							{
									/*$(".classc").each(function() {
										if($(this).parent().parent().find("td:nth-child(2) input").val()==name){						
				    						var value = $(this).val();
				 						   // add only if the value is number
				    						if(!isNaN(value) && value.length != 0 && value!=0) {
				        					sum += parseFloat(value);
				    						}
				    					}

									});*/
									//var a=$(this).parent().parent().find("td:nth-child(3) input").val();
									//alert(a);
									//$(this).parent().parent().find("td:nth-child(10)").text(sum.toFixed(2));	

									

						 			$(".classd").each(function() {
										if($(this).parent().parent().find("td:nth-child(2) input").val()==name){
				    						var value1 = $(this).val();
				    
				    						if(!isNaN(value1) && value1.length != 0 && value1!=0) {
				        					sum1 += parseFloat(value1);
				        					
				    						}
						    			}
									});

									//$(this).parent().parent().find("td:nth-child(11) ").text(sum1.toFixed(2));

									//var netshares=sum1-sum;
									var netshares=sum1;
									$(this).parent().parent().find("td:nth-child(12) ").text(netshares);

									if(isNaN(closing) || closing==0){
											 	closing=0;
											 	 //amount=(rate*purchase)+(rate*sales);
											 	 amount=(rate*qty);
											/*if(sales==0 && purchase==0){
													brok=0;
											}
											else{
												 brok=(amount*0.0001)/(sales+purchase);
											 }*/
											 if(qty==0){
													brok=0;
											}
											else{
												 brok=(amount*0.0001)/(qty);
											 }

											//console.log("sales="+sales);
											//console.log("purchase="+purchase);
											//console.log("rate="+rate);
											
											/*if(sales>0){
												net_rate=rate-brok;
											}
											else{
												net_rate=rate+brok;
											}

											 amount_net=(sales*net_rate)+(purchase*net_rate);*/	
											 if(qty>0){
												net_rate=rate+brok;
											}
											else{
												net_rate=rate-brok;
											}

											 //amount_net=(sales*net_rate)+(purchase*net_rate);
											 amount_net=qty*net_rate;
											if (isNaN(net_rate)){
											 	net_rate=0;
											 }

											if (isNaN(brok)){
											 	brok=0;
											 }

											if (isNaN(amount)){
											 	amount=0;
											 }

											if (isNaN(amount_net)){
											 	amount_net=0;
											 }
											 brok_amt=amount_net-amount;

											$(this).parent().parent().find("td:nth-child(7) ").text(net_rate.toFixed(2));
											$(this).parent().parent().find("td:nth-child(8) ").text(brok.toFixed(2));
											$(this).parent().parent().find("td:nth-child(9) ").text(amount.toFixed(2));
											$(this).parent().parent().find("td:nth-child(10)  ").text(amount_net.toFixed(2));
											$(this).parent().parent().find("td:nth-child(11) ").text(brok_amt.toFixed(2));

									}
									else
									{
									 		//$(this).parent().parent().after('<tr class="cls5"><td><input type="text" name="" onblur="stock()" class="classa"></td><td><input type="text" name="" onblur="stock()" class="classb"></td><td><input type="text" name="" onblur="stock()" class="classc"></td><td><input type="text" name="" onblur="stock()" class="classd"></td><td><input type="text" name="" onblur="stock()" class="classe"></td><td><input type="text" name="" onblur="stock()" class="classf"></td><td></td><td></td><td ></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td><input type="text" name="" onblur="stock()" class="clsclose"></td></tr>');
											amount=(-1)*closing*netshares;
											 	 
											/*if(sales==0 && purchase==0){
													brok=0;
											}*/
											if(qty==0){
													brok=0;
											}
											else{
												// brok=(amount*0.0001)/(netshares);
												brok=0;
											 }
											 if(netshares>0){
												net_rate=closing-brok;
											}
											else{
												net_rate=closing+brok;
											}
											amount_net=netshares*net_rate;	
											if (isNaN(net_rate)){
											 	net_rate=0;
											 }

											if (isNaN(brok)){
											 	brok=0;
											 }

											if (isNaN(amount)){
											 	amount=0;
											 }

											if (isNaN(amount_net)){
											 	amount_net=0;
											 }
											 var row1 = $(this).closest('tr');
											 var next = row1.next();

											var d = new Date();
											var date=d.getDate();
											var month=d.getMonth();
											var year=d.getFullYear();
											var hour=d.getHours();
											var min=d.getMinutes(); 
											next.find("td:nth-child(2) input").val(name+" closing at "+date+"/"+month+"/"+year+" "+hour+"-"+min);
											next.find("td:nth-child(1) input").prop("readonly", true);
											next.find("td:nth-child(2) input").prop("readonly", true);
											next.find("td:nth-child(3) input").prop("readonly", true);
											next.find("td:nth-child(4) input").prop("readonly", true);
											next.find("td:nth-child(6) input").prop("readonly", true); 	
											next.find("td:nth-child(19) input").prop("readonly", true);
											next.attr('disabled', 'true');
											next.find("td input").attr('disabled', 'true');
											/*next.find("td:nth-child(1) input").disabled=true;
											next.find("td:nth-child(2) input").disabled=true;
											next.find("td:nth-child(3) input").disabled=true;
											next.find("td:nth-child(4) input").disabled=true;
											next.find("td:nth-child(6) input").disabled=true;
											next.find("td:nth-child(6) ").disabled=true;
											next.find("td:nth-child(7) ").disabled=true;
											next.find("td:nth-child(8) ").disabled=true;
											next.find("td:nth-child(9) ").disabled=true;
											next.find("td:nth-child(10) ").disabled=true;
											next.find("td:nth-child(11) ").disabled=true;
											next.find("td:nth-child(12) ").disabled=true;
											next.find("td:nth-child(13) ").disabled=true;
											next.find("td:nth-child(14) ").disabled=true;
											next.find("td:nth-child(15) ").disabled=true;
											next.find("td:nth-child(16) ").disabled=true;
											next.find("td:nth-child(17) ").disabled=true;
											next.find("td:nth-child(18) ").disabled=true;
											next.find("td:nth-child(19) input").disabled=true;*/

											next.find("td:nth-child(7) ").text(net_rate.toFixed(2));
											next.find("td:nth-child(8) ").text(brok.toFixed(2));
											next.find("td:nth-child(9) ").text(amount.toFixed(2));
											next.find("td:nth-child(10) ").text(amount_net.toFixed(2));
									}					
													
														
									$(".classa").each(function() {
										if($(this).parent().parent().find("td:nth-child(2) input").val()==name){
				    						var value2 = $(this).parent().parent().find("td:nth-child(10) ").text();
				    
				    						/*if(!isNaN(value2) && value2.length != 0 && ($(this).parent().parent().find("td:nth-child(4) input").val()==0)) 
				    						{
				        							sum2 += parseFloat(value2);
				        					}
				        					else if(!isNaN(value2) && value2.length != 0 && ($(this).parent().parent().find("td:nth-child(3) input").val()==0))
				        					{
				        							sum3 += parseFloat(value2);		
				        					}	*/
				        					sum3 += parseFloat(value2);	
					        			}
									});

									//var clssales=sum2/sum;
									var clspurchase=sum3/sum1;

									/*if (isNaN(clssales)){
								 	clssales=0;
								 	}*/

								 	if (isNaN(clspurchase)){
								 	clspurchase=0;
									}
									if(isNaN(closing) || closing==0)
									{
									//$(this).parent().parent().find("td:nth-child(13) ").text(clssales.toFixed(2));
									//$(this).parent().parent().find("td:nth-child(14) ").text(clspurchase.toFixed(2));
									}
									else
									{
									//next.find("td:nth-child(13) ").text(clssales.toFixed(2));
									//next.find("td:nth-child(14) ").text(clspurchase.toFixed(2));
									}


									//var diff=clspurchase-clssales;
									if(isNaN(closing) || closing==0)
									{
									//$(this).parent().parent().find("td:nth-child(15) ").text(diff.toFixed(2));
									}
									else
									{
									//next.find("td:nth-child(15) ").text(diff.toFixed(2));
									}
									var netshares1=netshares;
									//var diff1=diff;
									if(netshares<0)
										{
											netshares1=netshares1*-1;
										}
									/*if(diff1<0)
										{
											diff1=diff1*-1;
										}*/

									/*if(sum1>sum)		
									{
										if(clssales>clspurchase)
										{	
											var sa1=clssales-((sum1*diff1)/netshares1);
											if(netshares1!=0)
											{	
												if(isNaN(closing) || closing==0)
												{
													$(this).parent().parent().find("td:nth-child(16) ").text(sa1.toFixed(2));
												}
												else
												{
													next.find("td:nth-child(16) ").text(sa1.toFixed(2));
												}
											}
											else
											{
												if(isNaN(closing) || closing==0)
												{
													$(this).parent().parent().find("td:nth-child(16) ").text("NA");
												}
												else
												{
													next.find("td:nth-child(16) ").text("NA");
												}
											}
										}
										else
										{
											var sa2=clspurchase+((sum*diff1)/netshares1);
											if(netshares1!=0)
											{
												if(isNaN(closing) || closing==0)
												{
													$(this).parent().parent().find("td:nth-child(16) ").text(sa2.toFixed(2));
												}
												else
												{
													next.find("td:nth-child(16) ").text(sa2.toFixed(2));
												}
											}
											else
											{
												if(isNaN(closing) || closing==0)
												{
													$(this).parent().parent().find("td:nth-child(16) ").text("NA");
												}
												else
												{
													next.find("td:nth-child(16) ").text("NA");
												}
											}	
											
										}	
												
									}
									else
									{	
											
											if(clssales>clspurchase)
										{	
											var sa1=clssales+((sum1*diff1)/netshares1);
											if(netshares1!=0)
											{
												if(isNaN(closing) || closing==0)
												{
													$(this).parent().parent().find("td:nth-child(16) ").text(sa1.toFixed(2));
												}
												else
												{
													next.find("td:nth-child(16) ").text(sa1.toFixed(2));
												}
											}
											else
											{
												$(this).parent().parent().find("td:nth-child(16) ").text("NA");	
											}
										}
										else
										{
											var sa2=clspurchase-((sum*diff1)/netshares1);
											if(netshares1!=0)
											{
												if(isNaN(closing) || closing==0)
												{
													$(this).parent().parent().find("td:nth-child(16) ").text(sa2.toFixed(2));
												}
												else
												{
													next.find("td:nth-child(16) ").text(sa2.toFixed(2));
												}
											}
											else
											{
												$(this).parent().parent().find("td:nth-child(16) ").text("NA");	
											}
										}		
									}	

									$(this).parent().parent().find("td:nth-child(16) ").text();
									if(isNaN(sa1) || sa1==0)
									{
										samt=sa2*netshares;
									}
									else
									{
										samt=sa1*netshares;
									}	
									if(isNaN(samt))
									{
										$(this).parent().parent().find("td:nth-child(17) ").text("NA");
									}
									else
									{	
										if(isNaN(closing) || closing==0)
										{
											$(this).parent().parent().find("td:nth-child(17) ").text(samt.toFixed(2));
										}
										else
										{
											next.find("td:nth-child(17) ").text(samt.toFixed(2));
										}
								    }*/

									var outstanding=sum3;
									if(isNaN(closing) || closing==0)
										{
											$(this).parent().parent().find("td:nth-child(13) ").text(outstanding.toFixed(2));
										}
									else
										{
											next.find("td:nth-child(13) ").text(outstanding.toFixed(2));
											var closingamt=outstanding+amount;
											next.find("td:nth-child(19) input").val(closingamt.toFixed(2));
										}

							}	

													
																				


					});



			
					
				

		});





}

function showentry(){
	console.log("inside show entry");
	
	$(".classd").each(function() {
		var name=$("#showall").val();
		//console.log("name="+name);
		var name1=$(this).parent().parent().find("td:nth-child(2) input ").val();
		//console.log("this.val="+name1);
		if(name=="")
		{

		}
		else if(name1==name)
		{
		//console.log("hello inside if");
		var date = $(this).parent().parent().find("td:nth-child(1) input ").val();	 	
        var name = $(this).parent().parent().find("td:nth-child(2) input ").val();
        var expiry = $(this).parent().parent().find("td:nth-child(3) input ").val();	 	
        var lot = $(this).parent().parent().find("td:nth-child(4) input ").val();
        var quantity = $(this).parent().parent().find("td:nth-child(5) input ").val();	 	
        var rate = $(this).parent().parent().find("td:nth-child(6) input ").val();
        var net_rate = $(this).parent().parent().find("td:nth-child(7) ").text();
        var brok = $(this).parent().parent().find("td:nth-child(8) ").text();
        var amt = $(this).parent().parent().find("td:nth-child(9) ").text();
        var amt_net = $(this).parent().parent().find("td:nth-child(10) ").text();
        var brokamt = $(this).parent().parent().find("td:nth-child(11) ").text();
        var net_shares = $(this).parent().parent().find("td:nth-child(12) ").text();
        outstanding_global = $(this).parent().parent().find("td:nth-child(13) ").text();
       
        var tbl_data ='<tr><td>'+date+'</td><td>'+name+'</td><td>'+expiry+'</td><td>'+lot+'</td><td>'+quantity+'</td><td>'+rate+'</td><td>'+net_rate+'</td><td>'+brok+'</td><td>'+amt+'</td><td>'+amt_net+'</td><td>'+brokamt+'</td><td>'+net_shares+'</td><td>'+outstanding_global+'</td></tr>';
    	//console.log("tbl_data="+tbl_data);
    	$('.stock1 tr:last').after(tbl_data);

    	}	
		

	});
	if($(".closingval").val()=="")
	{

	}
	else
	{	
		var d = new Date();
		var date=d.getDate();
		var month=d.getMonth();
		var year=d.getFullYear();
		var hour=d.getHours();
		var min=d.getMinutes(); 
		var date1="closing at "+date+"/"+month+"/"+year;	 	
        var name = $('.stock1 tr:last').find("td:nth-child(2)  ").text();
        var expiry = $('.stock1 tr:last').find("td:nth-child(3)  ").text();	 	
        var qty =$('.stock1 tr:last').find("td:nth-child(12)  ").text();
        //var quantity = $('.stock1 tr:last').find("td:nth-child(5)  ").text();	 	
        //var rate = $('.stock1 tr:last').find("td:nth-child(6) input ").val();
        qty=qty*(-1);
        var rate=$(".closingval").val();
        var amt =(rate*qty);
        var brok=(amt*0.0001)/(qty);
        var net_rate=0;
        if(qty>0){
			net_rate=rate+brok;
		}
		else{
			net_rate=rate-brok;
		}
		var lot=0;
		 //amount_net=(sales*net_rate)+(purchase*net_rate);
		 var amt_net=qty*net_rate;
        var netshares=0;
        var brokamt = amt_net-amt;
        //var net_shares = $('.stock1 tr:last').find("td:nth-child(12) ").text();
        var outstanding1 = parseFloat(outstanding_global,10)+amt_net;
        var tbl_data1 ='<tr><td>'+date1+'</td><td>'+name+'</td><td>'+expiry+'</td><td>'+lot+'</td><td>'+qty+'</td><td>'+rate+'</td><td>'+net_rate+'</td><td>'+brok+'</td><td>'+amt+'</td><td>'+amt_net+'</td><td>'+brokamt+'</td><td></td>'+netshares+'<td>'+outstanding1+'</td></tr>';
    	$('.stock1 tr:last').after(tbl_data1);
	}


}

/*function addRow(){
	$(".stock tr td input").keyup(function(event){
		var row2 = $(this).closest('tr');
		var next1 = row2.next();

		if($(this).parent().parent().find("td:nth-child(19) input")!="")
		{
			if(next1.find("td:nth-child(2) input").val()!=''||next1.find("td:nth-child(2) input").text()!='')
			{
			$(this).parent().parent().after('<tr class="cls5"><td><input type="text" name="" onblur="stock()" class="classa"></td><td><input type="text" name="" onblur="stock()" class="classb"></td><td><input type="text" name="" onblur="stock()" class="classc"></td><td><input type="text" name="" onblur="stock()" class="classd"></td><td><input type="text" name="" onblur="stock()" class="classe"></td><td><input type="text" name="" onblur="stock()" class="classf"></td><td></td><td></td><td ></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td><input type="text" name="" onblur="addRow(); stock()" class="clsclose"></td></tr>');
			}
		}	
	});
}*/



		
